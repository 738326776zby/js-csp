<html>
  <head>
    <meta charset="UTF-8"></meta>
    <title>Events</title>
    <script type="text/javascript" src="../../build/csp.bundled.browser.js"></script>
    <style>
      #field {
        background-color: #DDD;
        width: 50%;
        height: 50%;
      }
    </style>
  </head>
  <body>
    Mouse coordinates (if it's moving): <span id="display"></span>
    <div id="field">
    </div>
    <script type="text/javascript">
    var csp = require("csp"),
        fromEvent = csp.experiments.fromEvent;

    var el = document.getElementById("display");
    function show(text) {
      el.textContent = text;
      console.log(text);
    }

    var moves = fromEvent(document.getElementById("field"), "mousemove");

    csp.go(function*() {
      while (true) {
        var event = yield csp.take(moves);
        show(event.clientX + ":" + event.clientY);

        while (true) {
          var result = yield csp.alts([moves, csp.timeout(50)]);
          var value = result.value;
          if (value === csp.CLOSED) {
            show("");
            break;
          }
          event = value;
          show(event.clientX + ":" + event.clientY);
        }
      }
    });
    </script>
  </body>
</html>
